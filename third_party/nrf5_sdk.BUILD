cc_binary(
    name = "examples_dfu_bootloader_pca10028_single_bank_serial_s130",
    srcs = [
        "components/libraries/util/app_error.c",
        "components/libraries/util/app_error_weak.c",
        "components/libraries/scheduler/app_scheduler.c",
        "components/libraries/timer/app_timer.c",
        "components/libraries/timer/app_timer_appsh.c",
        "components/libraries/util/app_util_platform.c",
        "components/libraries/bootloader_dfu/bootloader.c",
        "components/libraries/bootloader_dfu/bootloader_settings.c",
        "components/libraries/bootloader_dfu/bootloader_util.c",
        "components/libraries/crc16/crc16.c",
        "components/libraries/bootloader_dfu/dfu_init_template.c",
        "components/libraries/bootloader_dfu/dfu_single_bank.c",
        "components/libraries/bootloader_dfu/dfu_transport_serial.c",
        "components/libraries/hci/hci_mem_pool.c",
        "components/libraries/hci/hci_slip.c",
        "components/libraries/hci/hci_transport.c",
        "components/libraries/util/nrf_assert.c",
        "components/libraries/uart/app_uart.c",
        "components/drivers_nrf/delay/nrf_delay.c",
        "components/drivers_nrf/common/nrf_drv_common.c",
        "components/drivers_nrf/uart/nrf_drv_uart.c",
        "components/drivers_nrf/pstorage/pstorage_raw.c",
        "examples/dfu/bootloader/main.c",
        "components/ble/common/ble_advdata.c",
        "components/ble/common/ble_conn_params.c",
        "components/ble/common/ble_srv_common.c",
        "components/toolchain/system_nrf51.c",
        "components/softdevice/common/softdevice_handler/softdevice_handler.c",
        "components/softdevice/common/softdevice_handler/softdevice_handler_appsh.c",
        "components/toolchain/gcc/gcc_startup_nrf51.S",
        ] + glob(["**/*.h"]),
    includes = [
        "examples/dfu/bootloader/config/dfu_single_bank_serial_s130_pca10028",
        "examples/dfu/bootloader/config",
        "components/libraries/bootloader_dfu/hci_transport",
        "components/libraries/bootloader_dfu",
        "components/libraries/scheduler",
        "components/drivers_nrf/config",
        "examples/bsp",
        "components/softdevice/s130/headers",
        "components/drivers_nrf/delay",
        "components/libraries/crc16",
        "components/libraries/util",
        "components/drivers_nrf/pstorage",
        "components/drivers_nrf/uart",
        "components/ble/common",
        "components/libraries/hci/config",
        "components/libraries/uart",
        "components/device",
        "components/libraries/hci",
        "components/libraries/timer",
        "components/toolchain/CMSIS/Include",
        "components/drivers_nrf/hal",
        "components/toolchain/gcc",
        "components/toolchain",
        "components/drivers_nrf/common",
        "components/softdevice//s130/headers/nrf51",
        "components/softdevice/common/softdevice_handler",
        "examples/dfu/bootloader/",
    ],
    defines = [
        "SWI_DISABLE0",
        "BOARD_PCA10028",
        "SOFTDEVICE_PRESENT",
        "NRF51",
        "__HEAP_SIZE=0",
        "S130",
        "BLE_STACK_SUPPORT_REQD",
        "BSP_DEFINES_ONLY"
    ],
    copts = [
        # "-x assembler-with-cpp",
        "-mcpu=cortex-m0",
        "-mthumb",
        "-mabi=aapcs",
        "--std=gnu99",
        "-Os",
        "-mfloat-abi=soft",
        "-fno-builtin",
        "--short-enums",
    ],
    linkopts = [
        # "-Xlinker -Map=output.map",
        "-mthumb",
        "-mabi=aapcs",
        "-Lexternal/nrf5_sdk/examples/dfu/bootloader",
        "-Lexternal/nrf5_sdk/components/toolchain/gcc",
        "-Tdfu_gcc_nrf51.ld",
        "-mcpu=cortex-m0",
        # use newlib in nano version
        "--specs=nano.specs",
    ],
    deps = [
        "examples/dfu/bootloader/dfu_gcc_nrf51.ld",
        "components/toolchain/gcc/nrf51_common.ld",
    ],
)
